(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5d4912c6"],{"9c6a":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("select-dept",{attrs:{visible:e.visible,loadData:e.getTree,replaceFields:{children:"childrens",key:"departmentId"}},on:{"update:visible":function(t){e.visible=t}}})],1)},a=[],n=i("a077"),l=i.n(n),c=i("d368"),d={name:"SelectDepts",components:{SelectDept:l.a},data:function(){return{visible:!1,getTree:c["getTree"]}},mounted:function(){var e=this;setTimeout((function(){e.visible=!0}),1e3)}},o=d,r=i("2877"),p=Object(r["a"])(o,s,a,!1,null,"9814c14a",null);t["default"]=p.exports},a077:function(e,t,i){!function(t,s){e.exports=s(i("b0c0"),i("d3b7"),i("caad"),i("2532"),i("159b"),i("d81d"),i("4de4"),i("b64b"),i("a9e3"),i("cfba"))}(0,(function(e,t,i,s,a,n,l,c,d,o){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function p(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function h(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function u(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?h(Object(i),!0).forEach((function(t){p(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function f(e,t,i,s,a,n,l,c,d,o){"boolean"!=typeof l&&(d=c,c=l,l=!1);const r="function"==typeof i?i.options:i;let p;if(e&&e.render&&(r.render=e.render,r.staticRenderFns=e.staticRenderFns,r._compiled=!0,a&&(r.functional=!0)),s&&(r._scopeId=s),n?(p=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,d(e)),e&&e._registeredComponents&&e._registeredComponents.add(n)},r._ssrRegister=p):t&&(p=l?function(e){t.call(this,o(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,c(e))}),p)if(r.functional){const e=r.render;r.render=function(t,i){return p.call(i),e(t,i)}}else{const e=r.beforeCreate;r.beforeCreate=e?[].concat(e,p):[p]}return i}const b={name:"IconFontBox",props:{type:{type:String,default:"iconqiyeweixin_021"},height:{type:[String,Number],default:""},color:{type:String,default:""},size:{type:[String,Number],default:"20"},display:{type:String,default:"inline-block"},overflow:{type:String,default:"hidden"}},components:{IconFont:r(o).default},methods:{handleClick:function(){this.$emit("click")}}};var m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"icon-font-wrap",style:{height:"auto"===e.height?"auto":e.height?e.height+"px":e.size+"px",color:e.color,fontSize:e.size+"px",display:e.display,overflow:e.overflow},on:{click:e.handleClick}},[i("icon-font",{staticClass:"icon-font-box",attrs:{type:e.type}})],1)};m._withStripped=!0;const v={name:"SelectDept",components:{IconFontBox:f({render:m,staticRenderFns:[]},void 0,b,void 0,!1,void 0,!1,void 0,void 0,void 0)},props:{value:{type:Array,default:function(){return[]}},valueType:{type:String,default:"object"},visible:{type:Boolean,default:!1},dataSource:{type:Array,default:function(){return[]}},loadData:{type:Function,default:null},replaceFields:{title:"name",key:"businessId",children:"children",main:"isMainDept"},expandAll:{type:Boolean,default:!0},title:{type:String,default:"选择部门"},beforeClose:{type:Function,default:null},mustMain:{type:Boolean,default:!1}},data:function(){return{loadingData:!1,confirmLoading:!1,selectedDeptList:{},selectedIdList:[],baseReplaceFields:{title:"name",key:"businessId",children:"children",main:"isMainDept"},treeData:[],mainDept:null}},computed:{modalVisible:{set:function(e){this.$emit("update:visible",e)},get:function(){return this.visible}}},watch:{visible:{handler:function(e){e&&(this.baseReplaceFields=u(u({},this.baseReplaceFields),this.replaceFields),this.dataSource.length?(this.treeData=this.dataSource,this.dealValue().setSelectDept()):this.getTreeList())},immediate:!0}},methods:{getTreeList:function(){var e=this;this.loadingData=!0,this.mainDept=null,this.treeData=[],this.loadData().then((function(t){var i=t.data||t;i.length?(e.mainDept=i[0],e.dealValue(),i[0][e.baseReplaceFields.children]&&(e.treeData=e.formatDeptData(i[0][e.baseReplaceFields.children])),e.selectedIdList.includes(e.mainDept[e.baseReplaceFields.key])&&(e.selectedDeptList[e.mainDept[e.baseReplaceFields.key]]=i[0]),e.selectedIdList.length&&e.selectedDeptList[e.selectedIdList[0]]&&e.mustMain&&(e.selectedDeptList[e.selectedIdList[0]][e.baseReplaceFields.main]=!0)):e.$message.error("没有获取到公司信息。")})).catch((function(){e.loadingData=!1})).finally((function(){e.loadingData=!1}))},dealValue:function(){var e=this;return this.value.forEach((function(t){if("object"===e.valueType)return t[e.baseReplaceFields.main]?e.selectedIdList.unshift(t[e.baseReplaceFields.key]):e.selectedIdList.push(t[e.baseReplaceFields.key]),void(e.selectedDeptList[t[e.baseReplaceFields.key]]=t);e.selectedIdList.push(t)})),this},setSelectDept:function(){var e=this;this.selectedIdList.length&&(!function t(i){i.forEach((function(i){e.selectedIdList.includes(i[e.baseReplaceFields.key])&&(e.selectedDeptList[i[e.baseReplaceFields.key]]=i),i[e.baseReplaceFields.children]&&t(i[e.baseReplaceFields.children])}))}(this.treeData),this.selectedIdList.length&&this.mustMain&&(this.selectedDeptList[this.selectedIdList[0]][this.baseReplaceFields.main]=!0))},formatDeptData:function(e){var t=this;return e.map((function(e){return t.selectedIdList.includes(e[t.baseReplaceFields.key])&&(t.selectedDeptList[e[t.baseReplaceFields.key]]=e),u(u({},e),{},p({scopedSlots:{title:"custom"}},t.baseReplaceFields.children,Array.isArray(e[t.baseReplaceFields.children])?t.formatDeptData(e[t.baseReplaceFields.children]):[]))}))},resetContent:function(){this.selectedIdList=[],this.selectedDeptList=[]},handleSelect:function(e,t){var i=this,s=null;if(s="main"===e?this.mainDept:t.node.dataRef,this.selectedDeptList[s[this.baseReplaceFields.key]]){var a=this.selectedDeptList[s[this.baseReplaceFields.key]][this.baseReplaceFields.main];this.selectedIdList=this.selectedIdList.filter((function(e){return e!==s[i.baseReplaceFields.key]}));var n=this.selectedDeptList;delete n[s[this.baseReplaceFields.key]],this.selectedDeptList=u({},n),a&&this.selectedIdList.length&&this.mustMain&&(this.selectedDeptList[this.selectedIdList[0]][this.baseReplaceFields.main]=!0)}else this.selectedIdList.push(s[this.baseReplaceFields.key]),this.selectedDeptList=u(u({},this.selectedDeptList),{},p({},s[this.baseReplaceFields.key],u(u({},s),{},p({},this.baseReplaceFields.main,!1)))),1===this.selectedIdList.length&&this.mustMain&&(this.selectedDeptList[this.selectedIdList[0]][this.baseReplaceFields.main]=!0)},handleOk:function(){var e=this,t=[];for(var i in this.selectedDeptList)this.selectedDeptList.hasOwnProperty(i)&&t.push(this.selectedDeptList[i]);var s=t.filter((function(t){return t[e.baseReplaceFields.main]}));this.emit(t),this.beforeClose?(this.confirmLoading=!0,this.beforeClose(p({selectedDeptList:t},this.baseReplaceFields.main,s.length?s[0]:null),this.handleCancel,(function(t){e.confirmLoading=t}))):(this.$emit("ok",p({selectedDeptList:t},this.baseReplaceFields.main,s.length?s[0]:null)),this.handleCancel())},emit:function(e){var t="object"===this.valueType?e:Object.keys(this.selectedDeptList);this.$emit("input",t)},handleCancel:function(){this.dataSource.length||(this.treeData=[]),this.confirmLoading=!1,this.$emit("update:visible",!1),this.resetContent()},handleSetDept:function(e){var t=this;this.selectedIdList.forEach((function(i){var s=t.selectedDeptList[i];s[t.baseReplaceFields.main]=s[t.baseReplaceFields.key]===e[t.baseReplaceFields.key]})),this.$forceUpdate()},handleRemove:function(e){var t=this,i=this.selectedDeptList;delete i[e[this.baseReplaceFields.key]],this.selectedDeptList=u({},i),this.selectedIdList=this.selectedIdList.filter((function(i){return i!==e[t.baseReplaceFields.key]})),e[this.baseReplaceFields.main]&&this.mustMain&&this.selectedIdList.length&&(this.selectedDeptList[this.selectedIdList[0]][this.baseReplaceFields.main]=!0)}}};var y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a-modal",{staticClass:"select-depts-wrap",attrs:{title:e.title,width:"785px",confirmLoading:e.confirmLoading,visible:e.modalVisible,"mask-closable":!1},on:{ok:e.handleOk,cancel:e.handleCancel}},[i("a-alert",{staticClass:"info-tip",attrs:{type:"info","show-icon":""}},[i("template",{slot:"message"},[e._t("default",[e._v("如果部门存在负责人，将自动把员工的直接上级设置为部门负责人")])],2)],2),e._v(" "),e.loadingData?i("a-spin",{staticClass:"loading"},[i("a-icon",{staticStyle:{"font-size":"24px"},attrs:{slot:"indicator",type:"loading",spin:""},slot:"indicator"})],1):e._e(),e._v(" "),i("div",{staticClass:"content"},[i("div",{staticClass:"flex-line"},[i("div",{staticClass:"top-title",on:{click:function(t){return e.handleSelect("main")}}},[i("icon-font-box",{staticClass:"icon-font-box",attrs:{type:"iconzuzhijiagou",size:"40",height:"40",color:"#AFB7C3"}}),e._v(" "),i("span",{staticClass:"title-txt"},[e._v(e._s(e.mainDept&&e.mainDept[e.baseReplaceFields.title]))])],1),e._v(" "),e.treeData.length?i("a-tree",{staticClass:"dept-tree",attrs:{"block-node":"","default-expand-all":e.expandAll,"tree-data":e.treeData,replaceFields:e.replaceFields},on:{select:e.handleSelect},scopedSlots:e._u([{key:"custom",fn:function(t){return[i("p",{staticClass:"tree-item"},[i("icon-font-box",{staticClass:"icon-font-box",attrs:{type:"icon_classification",size:"16",height:"16"}}),e._v(" "),i("span",{staticClass:"title"},[e._v("\n              "+e._s(t.dataRef[e.baseReplaceFields.title])+"\n            ")]),e._v(" "),e.selectedDeptList[t.dataRef[e.baseReplaceFields.key]]?i("a-icon",{staticClass:"dept-check",attrs:{type:"check"}}):e._e()],1)]}}],null,!1,6481298)},[i("a-icon",{attrs:{slot:"switcherIcon",type:"caret-down"},slot:"switcherIcon"})],1):e._e()],1),e._v(" "),i("div",{staticClass:"flex-line"},e._l(e.selectedIdList,(function(t,s){return i("div",{key:s,staticClass:"flex-box",class:{"is-main":e.selectedDeptList[t][e.baseReplaceFields.main]}},[i("icon-font-box",{staticClass:"icon-font-box",attrs:{type:"icon_classification",size:"16",height:"16"}}),e._v(" "),i("div",{staticClass:"dept-name"},[i("span",[e._v(e._s(e.selectedDeptList[t][e.baseReplaceFields.title]))])]),e._v(" "),i("div",{staticClass:"dept-level"},[e.selectedDeptList[t][e.baseReplaceFields.main]?i("span",[e._v("主部门")]):i("a",{attrs:{href:"javascript:void(0)"},on:{click:function(i){return e.handleSetDept(e.selectedDeptList[t])}}},[e._v("设为主部门")])]),e._v(" "),i("div",{staticClass:"line-close",on:{click:function(i){return e.handleRemove(e.selectedDeptList[t])}}},[i("a-icon",{attrs:{type:"close"}})],1)],1)})),0)])],1)};y._withStripped=!0;const D=f({render:y,staticRenderFns:[]},void 0,v,"data-v-5c970a70",!1,void 0,!1,void 0,void 0,void 0);return D.install=function(e){e.component(D.name,D)},D}))},b0c0:function(e,t,i){var s=i("83ab"),a=i("5e77").EXISTS,n=i("e330"),l=i("9bf2").f,c=Function.prototype,d=n(c.toString),o=/^\s*function ([^ (]*)/,r=n(o.exec),p="name";s&&!a&&l(c,p,{configurable:!0,get:function(){try{return r(o,d(this))[1]}catch(e){return""}}})},cfba:function(e,t,i){"use strict";i.r(t);var s=i("0c63"),a=s["a"].createFromIconfontCN({scriptUrl:"//at.alicdn.com/t/font_2273066_zh0fgc2hod.js"});t["default"]=a},d81d:function(e,t,i){"use strict";var s=i("23e7"),a=i("b727").map,n=i("1dde"),l=n("map");s({target:"Array",proto:!0,forced:!l},{map:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-5d4912c6.fa003b92.js.map